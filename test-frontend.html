<!DOCTYPE html>
<html>
<head>
    <title>Test Settings Frontend</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; }
        .info { background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #c8e6c9; padding: 10px; margin: 10px 0; }
        .error { background: #ffcdd2; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Settings API Test</h1>
    
    <div class="info">
        <h3>Current Settings:</h3>
        <p><strong>Notification Frequency:</strong> <span id="currentFrequency">Loading...</span> minutes</p>
    </div>
    
    <div>
        <label>New Frequency (minutes): </label>
        <input type="number" id="newFrequency" value="60" min="5" max="1440">
        <button onclick="saveSettings()">Save Settings</button>
    </div>
    
    <div>
        <button onclick="loadSettings()">Reload Settings</button>
    </div>
    
    <div id="message"></div>
    
    <div class="info">
        <h3>Console Logs:</h3>
        <pre id="logs"></pre>
    </div>

    <script>
        function log(msg) {
            const logsDiv = document.getElementById('logs');
            logsDiv.textContent += new Date().toLocaleTimeString() + ': ' + msg + '\n';
            console.log(msg);
        }

        async function loadSettings() {
            try {
                log('Loading settings...');
                const response = await fetch('http://localhost:3000/api/settings');
                const data = await response.json();
                log('Response: ' + JSON.stringify(data));
                
                if (data.success) {
                    document.getElementById('currentFrequency').textContent = data.settings.notificationFrequency;
                    log('✅ Settings loaded: ' + data.settings.notificationFrequency + ' minutes');
                } else {
                    log('❌ Failed to load settings');
                }
            } catch (error) {
                log('❌ Error: ' + error.message);
            }
        }

        async function saveSettings() {
            try {
                const newFreq = parseInt(document.getElementById('newFrequency').value);
                log('Saving settings: ' + newFreq + ' minutes');
                
                const response = await fetch('http://localhost:3000/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ notificationFrequency: newFreq })
                });
                
                const data = await response.json();
                log('Response: ' + JSON.stringify(data));
                
                if (data.success) {
                    document.getElementById('message').innerHTML = '<div class="success">✅ Settings saved!</div>';
                    log('✅ Settings saved successfully');
                    // Reload to verify
                    setTimeout(loadSettings, 500);
                } else {
                    document.getElementById('message').innerHTML = '<div class="error">❌ Failed: ' + data.error + '</div>';
                    log('❌ Failed to save: ' + data.error);
                }
            } catch (error) {
                document.getElementById('message').innerHTML = '<div class="error">❌ Error: ' + error.message + '</div>';
                log('❌ Error: ' + error.message);
            }
        }

        // Load on page load
        loadSettings();
    </script>
</body>
</html>
